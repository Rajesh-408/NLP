from pymongo import MongoClient

# Connect to your MongoDB instance
client = MongoClient('mongodb://localhost:27017')
db = client['your_database_name']
collection = db['your_collection_name']

# Define JSONPath expressions for field selection
jsonpath_expressions = [
    '$.data.field1',  # Replace with your first JSONPath expression
    '$.data.field2',  # Replace with your second JSONPath expression
    # Add more JSONPath expressions as needed
]

# Create the aggregation pipeline to extract distinct values
pipeline = [
    {
        '$project': {
            'jsonpath_values': {
                '$map': {
                    'input': jsonpath_expressions,
                    'as': 'expr',
                    'in': {
                        '$jsonSchema': {
                            'expression': '$$expr',
                            'jsonPath': '$$this'
                        }
                    }
                }
            }
        }
    },
    {
        '$unwind': '$jsonpath_values'
    },
    {
        '$group': {
            '_id': '$jsonpath_values',
            'distinctValues': {
                '$addToSet': '$jsonpath_values'
            }
        }
    },
    {
        '$project': {
            '_id': 0,
            'distinctValues': 1
        }
    }
]

# Execute the aggregation pipeline to get distinct values
result = list(collection.aggregate(pipeline))

# Extract the distinct values from the result
distinct_values = result[0]['distinctValues']

# Close the MongoDB connection
client.close()

# Print the distinct values
print(distinct_values)
