pipeline = [
    {
        '$group': {
            '_id': None,  # Group all documents into a single group
            'allValues': {
                '$push': {
                    '$reduce': {
                        'input': {
                            '$map': {
                                'input': {
                                    '$objectToArray': '$$ROOT'  # Convert document to key-value pairs
                                },
                                'as': 'kv',
                                'in': {
                                    '$cond': {
                                        'if': {
                                            '$isArray': '$$kv.v'  # Check if the value is an array
                                        },
                                        'then': '$$kv.v',  # If it's an array, keep it as is
                                        'else': {
                                            '$map': {
                                                'input': {'$split': ['$$kv.v', ',']},  # Split a string by commas
                                                'as': 'item',
                                                'in': {'$trim': {'input': '$$item'}}  # Trim whitespace
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        'initialValue': [],
                        'in': {'$setUnion': ['$$value', ['$$this']]}  # Merge and remove duplicates
                    }
                }
            }
        }
    },
    {
        '$project': {
            '_id': 0,  # Exclude the _id field
            'uniqueValues': '$allValues'  # Rename the field to uniqueValues
        }
    }
]
